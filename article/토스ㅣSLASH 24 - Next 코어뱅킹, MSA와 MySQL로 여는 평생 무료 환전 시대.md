# [토스ㅣSLASH 24 - Next 코어뱅킹, MSA와 MySQL로 여는 평생 무료 환전 시대](https://www.youtube.com/watch?v=uWnAVYgCd0k)

### 기술 전환 배경
- 모놀리식의 단점인 '단일 장애 지점'과 '제한적인 스케일 아웃'을 극복하기 위해 외환을 MSA로 분리.
  - 계정계의 Oracle DB가 하나다.
  - 모놀리식을 사용하는 이유는 강력한 트랜잭션 관리

### 외화예금 트랜잭션 아키텍처
- 사용자와 직접 닿는 부분은 동기 처리, 회계 처리 등 백오피스는 비동기(메시징)로 처리
- 잔액 변동에 대한 동시성 제어
  - 잔액 변동을 할 때 동시에 결제, 자동이체 같은 잔액 변동이 있으면 안 된다.
  - 레디스 Lock + DB Lock
- 수많은 거래 가능 검증은 코루틴으로 동시 처리

### 24/365 무중단 환전 서비스 구현
- 00:00 때 거래를 중지 한다. 거래가 빠짐없이 제대로 처리되었는지 잔액 대사가 있기 떄문.
- 거래 중지를 하지 않기 위해, 잔액 스냅샷 테이블을 만들어 활용한다.

### 테스트 자동화
- E2E 테스트를 위한 서버를 만든다.
  - 테스트 서버에 배포가 되면, E2E 테스트 서버에 트리거가 되어, 사전에 작성된 시나리오를 실제 거래 처럼 검증한다.
- 운영 이상거래탐지 서비스 개발 (데이터 완결성 검증)
- 테스트를 자동화해야 검증에 대한 시간을 줄일 수 있다.