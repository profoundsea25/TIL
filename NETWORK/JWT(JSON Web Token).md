# JWT(JSON Web Token)
> 아래의 글들을 참고/요약하였습니다.  
> [[Server] JWT(Json Web Token)란?](https://mangkyu.tistory.com/56)  
> [JWT(JSON Web Token)의 개념부터 구현까지 알아보기](https://pronist.dev/143)  
> [[JWT] JSON Web Token 소개 및 구조](https://velopert.com/2389)  
> [JWT란 무엇인가](https://tech.toktokhan.dev/2021/04/30/JWT/)  
> [JWT, 정확하게 무엇이고 왜 쓰이는 걸까?](https://velog.io/@junghyeonsu/%ED%94%84%EB%A1%A0%ED%8A%B8%EC%97%90%EC%84%9C-%EB%A1%9C%EA%B7%B8%EC%9D%B8%EC%9D%84-%EC%B2%98%EB%A6%AC%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95)
> 

### JWT란?
- JWT(Json Web Token) : JSON 포맷을 이용하여 사용자에 대한 속성을 저장하는 Claim 기반의 Web Token
- 토큰 자체를 정보로 사용하는 Self-Contained 방식으로 정보를 안전하게 전달
- 모바일이나 웹의 사용자 인증을 위해 사용하는 암호화된 토큰

### JWT 활용
#### 회원 인증
1. 클라이언트 사용자가 아이디, 패스워드를 통해 웹서비스 인증
2. 서버에 서명된(Signed) JWT를 생성하여 클라이언트에 응답으로 돌려주기
3. 클라이언트가 서버에 데이터를 추가적으로 요구할 때 JWT를 HTTP Header에 첨부
4. 서버에서 클라이언트로부터 온 JWT를 검증
#### 정보 교류
- 정보가 서명 되어있기 때문에(signed) 정보를 보낸이가 바뀌진 않았는지, 정보가 도중에 조작되지 않았는지 검증 가능 (두 개체 사이에서 안정성 있게 정보를 교환하기 좋은 방법)

### JWT 구조
- Header, Payload, Signature 3부분으로 나뉨
- JSON 형태의 각 부분은 Base64로 인코딩 됨
- 각각의 부분을 `.` 구분자를 사용하여 구분
#### Header
- Signature를 해싱하기 위한 알고리즘을 지정하는 부분
- `typ` : 토큰의 타입을 지정 ex) JWT
- `alg` : 알고리즘 방식을 지정하며, 서명(Signature) 및 토큰 검증에 사용 ex) HS256(SHA256) 또는 RSA
#### Payload
- 토큰에서 사용할 정보의 조각들인 Claim이 담겨 있음
- Claim의 종류는 총 3가지 : 등록된 클레임(Registered Claim), 공개 클레임(Public Claim), 비공개 클레임(Private Claim)
  - 등록된 클레임(Registered Claim)
    - 토큰 정보를 표현하기 위해 이미 정해진 종류의 데이터
    - 모두 선택적으로 작성 가능
    - 권장되는 클레임
    - `iss` : 토큰 발급자
    - `sub` : 토큰 제목
    - `aud` : 토큰 대상자
    - `exp` : 토큰 만료 시간(NumericDate 형식)
    - `nbf` : 토큰 활성 날짜
    - `iat` : 토큰 발급 시간
    - `jti` : JWT 토큰 식별자(JWT ID), 중복 방지를 위해 사용, 일회용 토큰(Access Token) 등에 사용
  - 공개 클레임(Public Claim)
    - 사용자 정의 클레임
    - 공개용 정보를 위해 사용
    - 충돌 방지를 위해 URI 포맷을 이용
  - 비공개 클레임(Private Claim)
    - 사용자 정의 클레임
    - 서버와 클라이언트 사이에 임의로 지정한 정보를 저장
#### Signature
- 서명이라고도 하며, 토큰을 인코딩하거나 유효성 검증을 할 때 사용하는 고유한 암호와 코드
- Header와 Payload 값을 각각 Base64로 인코딩하고, 인코딩한 값을 비밀 키를 이용해 Header에서 정의한 알고리즘으로 해싱을 하고, 이 값을 다시 Base64로 인코딩하여 생성

### JWT의 특징 (장점과 단점)
#### 장점
- 세션과 달리 서버가 아닌 클라이언트에 저장되기 때문에 메모리나 스토리지 등을 통해 세션을 관리했던 서버의 부담을 덜 수 있다.
- 서버에 저장하지 않기 때문에 서버의 확장성이 있다. 해당 토큰이 유효한지만 체크하면 되기 때문에 어떤 서버로 요청을 보내도 상관이 없다.
- 보안성 쿠키를 전달하지 않아도 되므로 쿠키를 사용함으로써 발생하는 취약점이 사라진다.
- 토큰을 사용하면 어떤 디바이스에서도, 어떤 도메인에서도 토큰만 유효하다면 요청이 정상적으로 처리된다.
#### 단점
- Self-Contained(자가 수용적) : 토큰 자체에 정보를 담고 있으므로 양날의 검이 될 수 있다.
- 토큰 길이 : 정보가 많아질수록 토큰의 길이가 늘어나 넼트워크에 부하를 줄 수 있다.
- Payload는 암호화가 아니라 Base64로 인코딩된 것으로, 중간에 탈취하여 디코딩으로 데이터를 볼 수 있다. 따라서 JWE로 암호화하거나 Payload에 중요 데이터를 넣지 않아야 한다.
- Stateless(무상태성) : 상태를 저장하지 않기 때문에 한번 만들어지면 제어가 불가능하다. 즉, 토큰을 임의로 삭제하는 것이 불가능하므로 토큰 만료 시간을 꼭 넣어주어야 한다.
- Tore Token : 토큰은 클라이언트 측에서 관리해야 하기 때문에, DB에서 사용자 정보를 수정하더라도 토큰에 직접 적용할 수 없다.
